<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8" />
    <title>WCM</title>
    <style>
        table, td, th {
            border: 1px solid black;
            text-align: center;
            height: 2rem;
        }
        table {
            border-collapse: collapse;
            width: 100%;
        }
        .yin {
            background-color: gray;
            color:white
        }
        .yang{
            background-color: white;
            color:gray;
        }
    </style>
</head>
<body>
    
    <textarea name="input" id="input" rows="6" style="width:70vw;margin:auto">米 氣 迷 咪  屎 尸 屎 尿 屁 </textarea>
    <br>
    <button onclick="myfunction()" id="mecha" disabled>cargando diccionario</button>
        <table id="outputo"></table>
        
        <script>
            let inputo = document.getElementById('input')
            let outputo = document.getElementById('outputo')
            let mecha = document.getElementById('mecha')
            let diccFul = null
            var bool= false;

            
            
            //fetch('./diccAcortado.json')
            fetch('https://raw.githubusercontent.com/zarlanga/wukongconmachete/main/diccAcortado.json')
            .then(
                d => d.json()
            )
            .then(
               d => {
                mecha.innerHTML = d[5].s ;
                mecha.disabled = false
                diccFul=d;
                myfunction(d) //acomodar aca

               }
            )
            /*
            .else(
                d => mecha.innerHTML = "asi era?"
            )*/

            const myfunction = (dicc=diccFul) => {
                let it = {s:"hanzi", t:"hanzi tradicional", p:"pinyin", e:"definicion"};
                outputo.innerHTML =`<tr><td>${it.s}</td>${gQV("trad") ? `<td>${it.t}</td>` :"" }<td>${it.p}</td><td>${it.e}</td></tr>`

                let caractPre = inputo.value.split("").filter(c => c != " " && c != "\n")
                //console.log(caractPre)
                

                
                let diccFiltrado = dicc.filter(i => caractPre.includes(i.s) || caractPre.includes(i.t))
                //let itemsOutputo =[];

                caractPre.forEach(c => {
                    let itemsC = diccFiltrado.find(it => (it.s == c || it.t == c) ) //filter
                    /*
                    itemsC.forEach(itC => 
                        //itemsOutputo.push(itC)
                        agregarcaracter(itC)
                    )*/
                    bool = !bool
                    agregarcaracter(itemsC)

                })

                /*
                itemsOutputo.forEach(element => {
                    agregarcaracter(element)
                });
                */

            }
            
            const agregarcaracter = (it) => {
                outputo.innerHTML += `
                <tr class=${ bool ? "yang": "yin"}>
                    <td>${it.s}</td>
                    ${gQV("trad") ? `<td>${it.t}</td>` :"" }
                    <td>${it.p}</td>
                    <td>${it.e}</td>
                </tr>`
            }

            
            function gQV(variable){
                var query = window.location.search.substring(1);
                var vars = query.split("&");
                for (var i=0;i<vars.length;i++) {
                        var pair = vars[i].split("=");
                        if(pair[0] == variable){return pair[1];}
                }
                return(false);
            }




        </script>
</body>
</html>